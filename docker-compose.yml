services:
  backend:
    image: nginx:1.29.5
    volumes:
      - ./configs/backend/static:/usr/share/nginx/html:ro
      - ./configs/backend/nginx.conf:/etc/nginx/nginx.conf:ro
    networks: [app-network]

  nginx:
    image: nginx:1.29.5
    ports: ["18080:80", "18443:443"]
    volumes:
      - ./configs/nginx/default.conf:/etc/nginx/conf.d/default.conf:ro
      - ssl_certs:/etc/nginx/ssl:ro
    networks: [app-network]

  caddy:
    image: caddy:2.10.2
    ports: ["18081:80", "18444:443"]
    volumes:
      - ./configs/caddy/Caddyfile:/etc/caddy/Caddyfile:ro
      - ssl_certs:/etc/caddy/ssl:ro
      - caddy_data:/data
      - caddy_config:/config
    networks: [app-network]

  traefik:
    image: traefik:v3.3.6
    command: ["--configFile=/etc/traefik/traefik.yml"]
    ports: ["18082:80", "18445:443"]
    volumes:
      - ./configs/traefik/traefik.yml:/etc/traefik/traefik.yml:ro
      - ./configs/traefik/dynamic.yml:/etc/traefik/dynamic.yml:ro
      - ssl_certs:/etc/traefik/ssl:ro
    networks: [app-network]

  test-runner:
    build: .
    command: sleep infinity
    volumes:
      - ./results:/app/results
      - /etc/os-release:/host/etc/os-release:ro
    networks: [app-network]

networks:
  app-network:

volumes:
  caddy_data:
  caddy_config:
  ssl_certs:
